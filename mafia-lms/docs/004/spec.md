# Use Case 004: 과제 상세 열람 (Learner)

## Primary Actor
- Learner (학습자)

## Precondition
- 사용자가 Learner 역할로 로그인되어 있음
- 사용자가 해당 과제가 속한 코스에 수강신청한 상태

## Trigger
- 사용자가 내 코스 목록에서 특정 코스의 과제 목록을 열람
- 사용자가 과제 목록에서 특정 과제를 클릭하여 상세 페이지로 이동

## Main Scenario

### 1. 과제 목록 조회
1. 사용자가 내 코스 중 하나를 선택하여 과제 목록 페이지에 접근
2. 시스템은 해당 코스에 대한 수강신청 여부를 확인
3. 시스템은 해당 코스의 `published` 상태 과제 목록을 조회
4. 각 과제에 대해 다음 정보를 표시:
   - 과제 제목
   - 마감일
   - 제출 상태 (미제출/제출완료/재제출필요/채점완료)

### 2. 과제 상세 열람
1. 사용자가 과제 목록에서 특정 과제를 클릭
2. 시스템은 과제 상세 정보를 로드하여 표시:
   - 과제 제목
   - 과제 설명 (상세 지시사항)
   - 마감일 (날짜 및 시간)
   - 점수 비중 (weight)
   - 지각 제출 허용 여부 (`allow_late`)
   - 재제출 허용 여부 (`allow_resubmission`)
3. 시스템은 사용자의 제출 이력을 조회하여 표시:
   - 제출 이력이 없는 경우: 빈 제출 양식 표시
   - 제출 이력이 있는 경우: 기존 제출 내용 표시 (텍스트, 링크, 제출일시, 채점 결과)

### 3. 제출 UI 표시
1. 과제 상태가 `published`인 경우:
   - 제출 양식 표시 (텍스트 입력란, 링크 입력란)
   - 제출 버튼 활성화
2. 과제 상태가 `closed`인 경우:
   - 제출 버튼 비활성화
   - "마감된 과제입니다" 메시지 표시
3. 재제출 가능 여부 판단:
   - 기존 제출물 상태가 `resubmission_required`이고 `allow_resubmission=true`인 경우: 재제출 가능
   - 그 외: 재제출 불가

## Edge Cases

### 권한 없음
- **조건**: 사용자가 해당 코스에 수강신청하지 않은 경우
- **처리**: 403 오류 반환, "수강신청한 코스가 아닙니다" 메시지 표시

### 과제가 존재하지 않음
- **조건**: 유효하지 않은 과제 ID로 접근
- **처리**: 404 오류 반환, "과제를 찾을 수 없습니다" 메시지 표시

### 비공개 과제 접근
- **조건**: 과제 상태가 `draft`인 경우
- **처리**: 403 오류 반환, "아직 공개되지 않은 과제입니다" 메시지 표시

### 미로그인 사용자 접근
- **조건**: 로그인하지 않은 상태에서 접근
- **처리**: 로그인 페이지로 리다이렉트

## Business Rules

### BR-1: 과제 열람 권한
- Learner는 자신이 수강신청한 코스의 `published` 상태 과제만 열람 가능
- `draft` 상태 과제는 Instructor만 열람 가능

### BR-2: 제출 가능 여부
- `published` 상태 과제만 제출 가능
- `closed` 상태 과제는 제출 불가 (제출 버튼 비활성화)
- 마감일 경과 후:
  - `allow_late=true`: 제출 가능 (지각 제출로 기록)
  - `allow_late=false`: 제출 불가

### BR-3: 재제출 가능 여부
- `allow_resubmission=true`이고 기존 제출물 상태가 `resubmission_required`인 경우에만 재제출 가능
- 재제출 시 기존 제출물을 덮어쓰지 않고 새로운 제출물 레코드 생성

### BR-4: 과제 정보 표시
- 지각 제출 허용 여부와 재제출 허용 여부를 명확히 표시
- 마감일을 시각적으로 강조 (예: 24시간 이내 마감 시 경고 색상)

### BR-5: 제출 이력 표시
- 사용자의 제출 이력이 있는 경우 기존 제출 내용을 표시
- 채점된 경우 점수와 피드백도 함께 표시
- 재제출 요청된 경우 "재제출 필요" 상태 표시
