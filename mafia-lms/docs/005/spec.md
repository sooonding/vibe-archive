# Use Case: 과제 제출/재제출 (Learner)

## Primary Actor
Learner

## Precondition
- 사용자가 Learner 역할로 로그인되어 있음
- 해당 코스에 수강 신청이 완료된 상태
- 과제 상태가 `published`
- 과제 상세 페이지에 접근한 상태

## Trigger
학습자가 과제 제출 버튼을 클릭

## Main Scenario
1. 학습자가 텍스트 필드에 답변 작성 (필수)
2. 학습자가 링크 필드에 URL 입력 (선택)
3. 학습자가 "제출" 버튼 클릭
4. 시스템이 마감일 검증
   - 마감일 전: `status=submitted`, `late=false`
   - 마감일 후 & 지각 허용: `status=submitted`, `late=true`
   - 마감일 후 & 지각 불허: 제출 차단
5. 시스템이 재제출 정책 검증 (이미 제출 이력이 있는 경우)
   - 재제출 허용: 기존 제출물 업데이트
   - 재제출 불허: 제출 차단
6. 시스템이 입력값 유효성 검증
   - 텍스트: 필수, 비어있지 않음
   - 링크: 선택, URL 형식 검증
7. 시스템이 제출물 저장
8. 시스템이 성공 메시지 표시
9. 학습자 화면에서 과제 상태 업데이트 (예: "제출 완료", "지각 제출")

## Edge Cases
- **텍스트 미입력**: "답변을 입력해주세요" 에러 표시
- **잘못된 링크 형식**: "올바른 URL 형식을 입력해주세요" 에러 표시
- **마감일 후 지각 불허**: "제출 기한이 지났습니다" 에러 표시
- **재제출 불허 상태에서 재제출 시도**: "재제출이 허용되지 않습니다" 에러 표시
- **과제 상태가 `closed`**: 제출 버튼 비활성화 및 "마감된 과제입니다" 표시
- **수강 신청 취소된 코스**: "수강 중인 코스가 아닙니다" 에러 및 접근 차단
- **네트워크 오류**: "제출에 실패했습니다. 다시 시도해주세요" 에러 표시

## Business Rules
- **마감일 정책**
  - 마감일 전: 정상 제출
  - 마감일 후: 과제별 `지각 허용` 설정에 따라 제출 가능 여부 결정
  - 지각 제출 시 `late=true` 플래그 설정
- **재제출 정책**
  - 과제별 `재제출 허용` 설정에 따라 재제출 가능 여부 결정
  - 재제출 시 기존 제출물 대체 (이력 관리는 별도 고려 가능)
- **입력값 검증**
  - 텍스트: 필수, 최소 1자 이상
  - 링크: 선택, 입력 시 URL 형식 검증
- **권한 검증**
  - 본인이 수강 중인 코스의 과제만 제출 가능
  - 과제 상태가 `published`일 때만 제출 가능
- **상태 관리**
  - 제출 성공 시 `submissions` 테이블에 레코드 생성/업데이트
  - 제출 상태: `submitted`
  - 채점 전까지 상태 유지
