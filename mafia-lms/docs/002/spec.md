# Use Case 002: 코스 탐색 & 수강신청/취소 (Learner)

## Primary Actor
학습자 (Learner 역할)

## Precondition
- 사용자가 Learner 역할으로 로그인한 상태
- 공개된 코스(status='published')가 존재

## Trigger
- 사용자가 코스 카탈로그 페이지 접근
- 사용자가 코스 상세 페이지에서 "수강신청" 또는 "수강취소" 버튼 클릭

## Main Scenario

### 코스 탐색
1. 사용자가 코스 카탈로그 페이지 접근
2. 시스템이 공개된 코스 목록 표시
3. 사용자가 검색어 입력 또는 필터 선택
   - 검색어: 코스 제목, 설명에서 검색
   - 필터: 카테고리, 난이도
   - 정렬: 최신순, 인기순
4. 시스템이 필터링된 결과 표시
5. 사용자가 코스 카드 클릭하여 상세 페이지 진입

### 수강신청
1. 사용자가 코스 상세 페이지에서 "수강신청" 버튼 클릭
2. 시스템이 수강신청 가능 여부 검증
   - 코스 상태가 'published'인지 확인
   - 중복 신청 여부 확인
3. 시스템이 `enrollments` 테이블에 기록 생성
4. 시스템이 성공 메시지 표시
5. 버튼이 "수강취소"로 변경됨
6. Learner 대시보드의 "내 코스" 목록에 추가됨

### 수강취소
1. 사용자가 코스 상세 페이지에서 "수강취소" 버튼 클릭
2. 시스템이 취소 확인 모달 표시
3. 사용자가 확인
4. 시스템이 `enrollments` 테이블에서 기록 삭제
5. 시스템이 성공 메시지 표시
6. 버튼이 "수강신청"으로 변경됨
7. Learner 대시보드의 "내 코스" 목록에서 제거됨
8. 해당 코스의 성적이 집계에서 제외됨

## Edge Cases

| 상황 | 처리 |
|------|------|
| 비공개 코스(draft/archived) 수강신청 시도 | "현재 수강신청이 불가능한 코스입니다" 오류 표시 |
| 이미 수강 중인 코스 재신청 시도 | "이미 수강 중인 코스입니다" 오류 표시 |
| 네트워크 오류 | "잠시 후 다시 시도해주세요" 오류 표시 |
| 동시성 문제 (여러 탭에서 동시 신청) | DB 제약조건으로 차단, "이미 수강 중인 코스입니다" 오류 표시 |
| 수강취소 실패 | "수강취소에 실패했습니다" 오류 표시, 재시도 가능 |
| 존재하지 않는 코스 | 404 페이지 표시 |
| Instructor 역할이 수강신청 시도 | "학습자 계정으로만 수강신청할 수 있습니다" 오류 표시 |

## Business Rules

### 수강신청 조건
- 코스 상태가 'published'인 경우에만 가능
- Learner 역할만 수강신청 가능
- 동일 코스에 대한 중복 신청 불가
- 로그인 상태 필수

### 수강취소 조건
- 수강 중인 코스만 취소 가능
- 취소 시 확인 모달 표시 (실수 방지)
- 취소 후 재신청 가능

### 데이터 정책
- `enrollments` 테이블에 (learner_id, course_id) 조합이 PK
- 수강취소 시 관련 성적 데이터는 집계에서 제외되지만 삭제되지 않음
- 수강신청 시점 타임스탬프 기록 (`enrolled_at`)

### 검색 & 필터
- 검색어: 코스 제목, 설명에서 대소문자 구분 없이 부분 일치 검색
- 카테고리 필터: 다중 선택 가능 (OR 조건)
- 난이도 필터: 다중 선택 가능 (OR 조건)
- 정렬:
  - 최신순: `created_at DESC`
  - 인기순: 수강생 수 기준 (`enrollments count DESC`)
- 필터는 AND 조건으로 결합 (검색어 AND 카테고리 AND 난이도)

### UI 상태
- 수강 중인 코스: "수강취소" 버튼 표시
- 미수강 코스: "수강신청" 버튼 표시
- 비공개 코스(draft/archived): 버튼 비활성화 및 안내 메시지
- 처리 중: 버튼 비활성화 및 로딩 표시

### 리다이렉션
- 수강신청 성공 시: 현재 페이지 유지, 버튼 상태만 변경
- 수강취소 성공 시: 현재 페이지 유지, 버튼 상태만 변경
- 비로그인 상태에서 신청 시도: 로그인 페이지로 리다이렉트
